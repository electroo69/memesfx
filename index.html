<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Memesfx | The Modern Soundboard</title>
    <meta name="title" content="Memesfx | The Modern Soundboard" />
    <meta name="description" content="Discover funny instant sound buttons. Listen and share sounds of memes, gaming, movies, anime, and more." />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
      :root {
        --bg-body: #F3F5F7;
        --bg-card: #FFFFFF;
        --text-main: #0F172A;
        --text-muted: #64748B;
        --primary: #6366f1;
        --radius-xl: 24px;
        --radius-lg: 16px;
        --radius-md: 12px;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-hover: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        --font-main: 'Plus Jakarta Sans', sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        background-color: var(--bg-body);
        color: var(--text-main);
        font-family: var(--font-main);
        line-height: 1.5;
        overflow-x: hidden;
      }

      /* Layout & Containers */
      .page-wrapper {
        display: flex;
        justify-content: center;
        gap: 2rem;
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      .container {
        flex: 1;
        max-width: 1000px;
        width: 100%;
      }

      /* Header Styling */
      header {
        text-align: center;
        margin-bottom: 3rem;
        position: relative;
      }

      h1 {
        font-weight: 800;
        font-size: 3rem;
        letter-spacing: -0.03em;
        margin-bottom: 0.5rem;
        color: var(--text-main);
        background: linear-gradient(135deg, #0F172A 0%, #334155 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .subtitle {
        color: var(--text-muted);
        font-weight: 500;
        font-size: 1.1rem;
      }

      /* Search Bar */
      .search-wrapper {
        position: sticky;
        top: 20px;
        z-index: 100;
        margin-bottom: 3rem;
        display: flex;
        justify-content: center;
      }

      .search {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        padding: 0.5rem;
        border-radius: 50px;
        box-shadow: 0 10px 40px -10px rgba(0,0,0,0.08);
        border: 1px solid rgba(255,255,255,0.5);
        width: 100%;
        max-width: 500px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .search:focus-within {
        transform: translateY(-2px);
        box-shadow: 0 15px 50px -10px rgba(0,0,0,0.12);
        border-color: var(--primary);
      }

      #searchInput {
        flex: 1;
        border: none;
        background: transparent;
        padding: 1rem 1.5rem;
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-main);
        font-family: var(--font-main);
        outline: none;
      }

      #searchBtn {
        background: var(--text-main);
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 40px;
        font-weight: 700;
        font-size: 0.9rem;
        cursor: pointer;
        transition: background 0.2s;
        margin-right: 4px;
      }

      #searchBtn:hover {
        background: #334155;
      }

      /* Ad Containers */
      .ad-container {
        background: #fff;
        border-radius: var(--radius-lg);
        padding: 1rem;
        margin: 2rem 0;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: var(--shadow-sm);
        border: 1px solid #E2E8F0;
      }
      
      .side-ad-sticky {
        position: sticky;
        top: 2rem;
      }

      /* Grid System */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
      }

      /* Modern Card Design */
      .sound-card {
        background: var(--bg-card);
        border-radius: var(--radius-xl);
        padding: 1.25rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        border: 1px solid #F1F5F9;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        overflow: hidden;
        height: 100%;
        min-height: 220px;
      }

      .sound-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--shadow-hover);
        border-color: transparent;
      }

      /* Decorative Background Blob */
      .card-bg-blob {
        position: absolute;
        top: -20%;
        right: -20%;
        width: 150px;
        height: 150px;
        background: var(--blob-color);
        opacity: 0.1;
        border-radius: 50%;
        filter: blur(40px);
        z-index: 0;
        pointer-events: none;
      }

      /* Play Button */
      .play-btn-wrapper {
        position: relative;
        z-index: 1;
        width: 100%;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .play-button {
        width: 80px;
        height: 80px;
        border-radius: 28px; /* Squircle */
        background: var(--btn-color);
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 10px 20px -5px var(--btn-shadow);
      }

      .play-button svg {
        fill: currentColor;
        width: 32px;
        height: 32px;
        margin-left: 4px; /* Optical center adjustment */
      }

      .play-button:hover {
        transform: scale(1.1) rotate(-3deg);
      }

      .play-button:active {
        transform: scale(0.95);
      }

      /* Card Content */
      .card-content {
        z-index: 1;
        width: 100%;
        text-align: center;
      }

      .sound-title {
        display: block;
        font-weight: 700;
        font-size: 0.95rem;
        color: var(--text-main);
        text-decoration: none;
        margin-bottom: 0.5rem;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        line-height: 1.3;
      }

      .sound-title:hover {
        color: var(--primary);
      }

      /* Minimal Download Button */
      .download-btn {
        width: 100%;
        padding: 0.5rem;
        border-radius: var(--radius-md);
        border: 1px solid #E2E8F0;
        background: white;
        color: var(--text-muted);
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .download-btn:hover {
        background: #F8FAFC;
        border-color: #CBD5E1;
        color: var(--text-main);
      }

      .download-btn svg {
        width: 14px;
        height: 14px;
        fill: currentColor;
      }

      /* Single Sound View */
      #singleSoundView {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 50vh;
        animation: fadeIn 0.4s ease;
      }

      #singleSoundContainer .sound-card {
        width: 300px;
        height: 350px;
      }

      #singleSoundContainer .play-button {
        width: 120px;
        height: 120px;
        font-size: 3rem;
      }

      #backBtn {
        background: white;
        border: 1px solid #E2E8F0;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 2rem;
        align-self: flex-start;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
      }

      #backBtn:hover {
        background: #F1F5F9;
        transform: translateX(-4px);
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 2rem;
      }

      .page-btn {
        background: white;
        border: 1px solid #E2E8F0;
        width: 44px;
        height: 44px;
        border-radius: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        color: var(--text-main);
      }

      .page-btn:hover:not(:disabled) {
        background: var(--text-main);
        color: white;
        border-color: var(--text-main);
      }

      .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      #pageInfo {
        font-weight: 600;
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      #loading {
        text-align: center;
        padding: 2rem;
        font-weight: 600;
        color: var(--text-muted);
        display: none;
      }

      /* Utilities */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .left-sidebar-ad, .right-sidebar-ad {
          display: none;
        }
      }

      @media (max-width: 640px) {
        h1 { font-size: 2rem; }
        .grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
        }
        .sound-card {
          min-height: 180px;
          padding: 1rem;
        }
        .play-button {
          width: 60px;
          height: 60px;
          border-radius: 20px;
        }
        .search-wrapper {
          padding: 0 1rem;
        }
      }
    </style>

    <script id="schema-struct" type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Memesfx",
        "url": "https://memesfx.gyatbox.space/"
      }
    </script>
  </head>
  <body>
    <div class="page-wrapper">
      
      <aside class="left-sidebar-ad">
        <div class="side-ad-sticky">
           <div class="ad-container" style="width: 160px; min-height: 600px; padding: 0;">
            <script type="text/javascript">
                atOptions = {
                    'key' : 'a987403d86d10ea7dae571a081e651c4',
                    'format' : 'iframe',
                    'height' : 600,
                    'width' : 160,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/a987403d86d10ea7dae571a081e651c4/invoke.js"></script>
           </div>
        </div>
      </aside>

      <div class="container">
        
        <header>
          <h1 id="pageHeader">Memesfx</h1>
          <p class="subtitle">Your favorite crypto wallet... wait, soundboard.</p>
        </header>

        <div class="ad-container" style="min-height: 90px; overflow: hidden;">
            <script type="text/javascript">
                atOptions = {
                    'key' : 'c50bb328670da58a01a9ba5ef5827975',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/c50bb328670da58a01a9ba5ef5827975/invoke.js"></script>
        </div>

        <main>
          <div class="search-wrapper">
            <div class="search">
              <input type="text" id="searchInput" placeholder="Search for sounds..." />
              <button id="searchBtn">Search</button>
            </div>
          </div>

          <div id="singleSoundView">
            <button id="backBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                Back to Sounds
            </button>
            <div id="singleSoundContainer"></div>
          </div>

          <div id="mainGridView">
             <h2 id="sectionTitle" style="font-weight: 700; margin-bottom: 1.5rem; font-size: 1.5rem;">Trending Sounds</h2>
             <div id="soundsGrid" class="grid"></div>

             <div id="loading">
                <svg width="30" height="30" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="animation: spin 1s linear infinite; margin-bottom: 10px;"><style>@keyframes spin{100%{transform:rotate(360deg)}}</style><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"/><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z"/></svg>
                <br>Loading sounds...
             </div>

             <div id="pagination" class="pagination" style="display: none">
                <button id="prevBtn" class="page-btn" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                </button>
                <span id="pageInfo">Page 1</span>
                <button id="nextBtn" class="page-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                </button>
             </div>
          </div>

          <div class="ad-container" style="min-height: 90px; overflow: hidden;">
            <script type="text/javascript">
                atOptions = {
                    'key' : 'c50bb328670da58a01a9ba5ef5827975',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/c50bb328670da58a01a9ba5ef5827975/invoke.js"></script>
          </div>
        </main>
      </div>

      <aside class="right-sidebar-ad">
        <div class="side-ad-sticky">
           <div class="ad-container" style="width: 160px; min-height: 600px; padding: 0;">
            <script type="text/javascript">
                atOptions = {
                    'key' : 'a987403d86d10ea7dae571a081e651c4',
                    'format' : 'iframe',
                    'height' : 600,
                    'width' : 160,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/a987403d86d10ea7dae571a081e651c4/invoke.js"></script>
           </div>
        </div>
      </aside>

    </div>

    <script>
      let currentAudio = null;
      let currentPage = 1;
      const maxPage = 50;
      const pageCache = new Map();
      const preloadQueue = new Set();

      // Modern Color Palette derived from reference
      const themes = [
        { color: "#2E90FA", shadow: "rgba(46, 144, 250, 0.4)" }, // Blue
        { color: "#F63D68", shadow: "rgba(246, 61, 104, 0.4)" }, // Pink/Red
        { color: "#FDB022", shadow: "rgba(253, 176, 34, 0.4)" }, // Orange/Yellow
        { color: "#12B76A", shadow: "rgba(18, 183, 106, 0.4)" }, // Green
        { color: "#9B8AFB", shadow: "rgba(155, 138, 251, 0.4)" }, // Purple
        { color: "#00E0C6", shadow: "rgba(0, 224, 198, 0.4)" }   // Teal
      ];

      function getRandomTheme(index) {
        return themes[index % themes.length];
      }

      function playSound(mp3Url, btnElement) {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio = null;
        }
        
        // Simple visual feedback
        btnElement.style.transform = "scale(0.9)";
        setTimeout(() => { btnElement.style.transform = "scale(1)"; }, 150);

        currentAudio = new Audio(mp3Url);
        currentAudio.play().catch((e) => console.error("Playback failed:", e));
      }

      function createAdElement() {
        // Keeps the layout stable but wraps ad logic
        const container = document.createElement("div");
        container.className = "ad-container";
        container.style.gridColumn = "1 / -1"; // Span full width in grid
        
        const iframe = document.createElement('iframe');
        iframe.style.width = '728px'; 
        iframe.style.height = '90px'; 
        iframe.style.border = 'none';
        iframe.scrolling = "no";
        
        container.appendChild(iframe);

        setTimeout(() => {
            try {
                const doc = iframe.contentWindow.document;
                doc.open();
                doc.write(`
                    <html><body style="margin:0;padding:0;display:flex;justify-content:center;">
                    <script type="text/javascript">
                        atOptions = { 'key' : 'c50bb328670da58a01a9ba5ef5827975', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
                    <\/script>
                    <script type="text/javascript" src="//www.highperformanceformat.com/c50bb328670da58a01a9ba5ef5827975/invoke.js"><\/script>
                    </body></html>
                `);
                doc.close();
            } catch (e) { console.log("Ad injection error", e); }
        }, 50);

        return container;
      }

      function createSoundDOM(sound, index, isSingleView = false) {
        const theme = getRandomTheme(index || 0);

        const card = document.createElement("div");
        card.className = "sound-card";
        // Pass theme variables to CSS
        card.style.setProperty('--blob-color', theme.color);
        card.style.setProperty('--btn-color', theme.color);
        card.style.setProperty('--btn-shadow', theme.shadow);

        // Background decorative blob
        const blob = document.createElement("div");
        blob.className = "card-bg-blob";
        card.appendChild(blob);

        // Play Button Area
        const playWrapper = document.createElement("div");
        playWrapper.className = "play-btn-wrapper";
        
        const playBtn = document.createElement("button");
        playBtn.className = "play-button";
        playBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>`;
        playBtn.onclick = (e) => {
            e.stopPropagation(); // Prevent card click
            playSound(sound.mp3, playBtn);
        };
        playWrapper.appendChild(playBtn);
        card.appendChild(playWrapper);

        // Content Area
        const content = document.createElement("div");
        content.className = "card-content";

        // Title Link
        const titleLink = document.createElement("a");
        titleLink.className = "sound-title";
        titleLink.href = `?sound=${sound.id}`;
        titleLink.textContent = sound.title;
        titleLink.onclick = (e) => {
            e.preventDefault();
            window.history.pushState({ soundId: sound.id }, "", `?sound=${sound.id}`);
            loadSingleSound(sound);
        };
        content.appendChild(titleLink);

        // Download Button
        const downloadBtn = document.createElement("button");
        downloadBtn.className = "download-btn";
        downloadBtn.innerHTML = `
            <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
            Download MP3
        `;
        downloadBtn.onclick = async (e) => {
            e.stopPropagation();
            downloadBtn.innerHTML = "Downloading...";
            try {
                const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(sound.mp3)}`;
                const response = await fetch(proxyUrl);
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = sound.title + ".mp3";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                downloadBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Saved!`;
                setTimeout(() => {
                    downloadBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg> Download MP3`;
                }, 2000);
            } catch (error) {
                console.error("Download failed:", error);
                downloadBtn.innerText = "Error";
            }
        };
        content.appendChild(downloadBtn);
        card.appendChild(content);

        return card;
      }

      function displaySounds(sounds) {
        const grid = document.getElementById("soundsGrid");
        grid.innerHTML = "";

        const itemsPerRow = Math.floor(grid.offsetWidth / 200) || 4; 
        const rowsBeforeAd = 2;
        const itemsBeforeAd = itemsPerRow * rowsBeforeAd;

        sounds.forEach((sound, index) => {
          if (index > 0 && index % 12 === 0) { // Insert ad every 12 items
            grid.appendChild(createAdElement());
          }
          grid.appendChild(createSoundDOM(sound, index));
        });
      }

      function updatePagination() {
        document.getElementById("pageInfo").textContent = `Page ${currentPage} of ${maxPage}`;
        document.getElementById("prevBtn").disabled = currentPage === 1;
        document.getElementById("nextBtn").disabled = currentPage === maxPage;
      }

      async function fetchSounds(endpoint, params) {
        let targetUrl = `https://instants-api.vercel.app${endpoint}`;
        const url = new URL(targetUrl);
        Object.entries(params || {}).forEach(([key, value]) =>
          url.searchParams.set(key, value)
        );
        targetUrl = url.toString();
        const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(targetUrl)}`;
        const response = await fetch(proxyUrl);
        if (!response.ok) throw new Error("Failed to fetch sounds");
        const data = await response.json();
        return data.data || [];
      }

      // SEO & Routing Logic
      function updateSEOMetadata(title, description, image) {
        document.title = title;
        document.querySelector('meta[name="title"]').setAttribute("content", title);
        document.querySelector('meta[name="description"]').setAttribute("content", description);
        if(document.getElementById("pageHeader")) document.getElementById("pageHeader").textContent = title.split(" - ")[0];
      }

      function injectJSONLD(sound) {
        const schema = {
            "@context": "https://schema.org",
            "@type": "AudioObject",
            "name": sound.title,
            "description": `Play and download ${sound.title} sound effect.`,
            "contentUrl": sound.mp3,
            "encodingFormat": "audio/mpeg",
            "uploadDate": new Date().toISOString()
        };
        document.getElementById('schema-struct').textContent = JSON.stringify(schema);
      }

      async function loadSingleSound(sound) {
         document.getElementById("mainGridView").style.display = "none";
         document.getElementById("singleSoundView").style.display = "flex";
         
         const container = document.getElementById("singleSoundContainer");
         container.innerHTML = "";
         container.appendChild(createSoundDOM(sound, 3, true)); // Fixed theme color for single view

         const pageTitle = `${sound.title} Sound Button | Memesfx`;
         const pageDesc = `Play and download ${sound.title} sound effect for free on Memesfx.`;
         updateSEOMetadata(pageTitle, pageDesc, sound.image);
         injectJSONLD(sound);
         window.scrollTo(0, 0);
      }

      async function loadTrending(page) {
        if (page < 1 || page > maxPage) return;
        currentPage = page;

        document.getElementById("mainGridView").style.display = "block";
        document.getElementById("singleSoundView").style.display = "none";
        document.getElementById("loading").style.display = "block";
        document.getElementById("soundsGrid").style.display = "none";

        if (pageCache.has(page)) {
          finishLoading(pageCache.get(page));
          return;
        }

        try {
          const sounds = await fetchSounds("/api/trending", { q: "id", page, limit: 50 });
          pageCache.set(page, sounds);
          finishLoading(sounds);
          preloadNextPages(page);
        } catch (error) {
          console.error("Error loading trending:", error);
          document.getElementById("loading").innerText = "Error loading sounds.";
        }
      }

      function finishLoading(sounds) {
          document.getElementById("loading").style.display = "none";
          document.getElementById("soundsGrid").style.display = "grid";
          displaySounds(sounds);
          updatePagination();
          document.getElementById("pagination").style.display = "flex";
      }

      function preloadNextPages(page) {
         if (page < maxPage && !pageCache.has(page + 1)) {
            fetchSounds("/api/trending", { q: "id", page: page + 1, limit: 50 })
                .then(s => pageCache.set(page + 1, s))
                .catch(e => console.log(e));
         }
      }

      async function performSearch(term) {
        document.getElementById("loading").style.display = "block";
        document.getElementById("singleSoundView").style.display = "none";
        document.getElementById("mainGridView").style.display = "block";
        document.getElementById("soundsGrid").innerHTML = "";
        
        try {
          const sounds = await fetchSounds("/search", { q: term, limit: 20 });
          document.getElementById("loading").style.display = "none";
          displaySounds(sounds);
          document.getElementById("pagination").style.display = "none";
        } catch (error) {
          console.error("Error searching:", error);
        }
      }

      // Event Listeners
      document.getElementById("searchBtn").onclick = () => {
        const term = document.getElementById("searchInput").value.trim();
        if (term) {
             window.history.pushState({ search: term }, "", `?search=${encodeURIComponent(term)}`);
             document.getElementById("sectionTitle").textContent = `Results: "${term}"`;
             performSearch(term);
        } else {
             window.history.pushState({}, "", "/");
             document.getElementById("sectionTitle").textContent = "Trending Sounds";
             loadTrending(1);
        }
      };
      
      document.getElementById("searchInput").onkeypress = (e) => {
        if (e.key === "Enter") document.getElementById("searchBtn").click();
      };

      document.getElementById("backBtn").onclick = () => {
         window.history.pushState({}, "", "/");
         document.getElementById("sectionTitle").textContent = "Trending Sounds";
         loadTrending(1);
      };

      document.getElementById("prevBtn").onclick = () => loadTrending(currentPage - 1);
      document.getElementById("nextBtn").onclick = () => loadTrending(currentPage + 1);

      // Initialization
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        const results = regex.exec(window.location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      window.onload = () => {
        const searchParam = getUrlParameter("search");
        const soundParam = getUrlParameter("sound");

        if (soundParam) {
           // Fallback since we can't fetch single ID directly in this demo API structure easily
           // We load trending then search locally or perform a search
           fetchSounds("/search", { q: soundParam, limit: 1 }).then(res => {
               if(res.length) loadSingleSound(res[0]);
               else loadTrending(1);
           });
        } else if (searchParam) {
           document.getElementById("searchInput").value = searchParam;
           document.getElementById("sectionTitle").textContent = `Results: "${searchParam}"`;
           performSearch(searchParam);
        } else {
           loadTrending(1);
        }
      };

      window.onpopstate = (event) => {
          // Basic state handling for back button
          if(event.state && event.state.soundId) { 
              // handle sound view
          } else {
              document.getElementById("singleSoundView").style.display = "none";
              document.getElementById("mainGridView").style.display = "block";
              displaySounds(pageCache.get(currentPage) || []);
          }
      };
    </script>
  </body>
</html>
